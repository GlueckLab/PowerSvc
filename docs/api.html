<!--  
 * Power Service for the GLIMMPSE Software System.  Processes
 * incoming HTTP requests for power, sample size, and detectable
 * difference
 * 
 * Copyright (C) 2010 Regents of the University of Colorado.  
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */
-->
<head>
<title>GLIMMPSE: Power Service REST API</title>
 <STYLE type="text/css">
  H1 {
    border-width: 1; border: solid; 
    text-align: center; 
    background: #005C84;
    color: white;
   ;}
 
 div.toc {
 }
 
 div.toc1 {
 	text-indent: 40px;
 }
 
 div.toc2 {
 	text-indent: 60px;
 }
 
  div.toc3 {
 	text-indent: 80px;
 }

 td.borderRight {
 	border-right: 1px solid #000;
 	text-align: center;
 }
 
tr.bgGray {
	background: #ddd;
 }
 
table {
	border-collapse: collapse;
	border: 1px solid black;
 }
 
table td, th {
 	border: 1px solid black;
 	spacing: 0;
 	padding: 5px;
 }
 
 table th {
	background: #ddd;
 }
 
 </STYLE>
</head>
<body>
<h1>GLIMMPSE: Power Service REST API</h1>

<h2>Introduction</h2>

The Glimmpse software system provides a web based user interface to estimate power and sample size
for the general linear multivariate model (GLMM) with or without a baseline covariate.  The Glimmpse system
consists of four main components:
<ul>
<li>Glimmpse.com user interface - a Javascript/GWT front-end user interface</li>
<li><b>Power Service</b> - RESTful Java web service which processes power/sample size requests</li>
<li>Chart Service - RESTful Java web service which produces graphs.  For the Glimmpse system, this service
produces power curves.</li>
<li>File Service - RESTful Java web service providing upload/save functionality for study design information</li>
<li>JavaStatistics library - low level library containing routines for computing GLMM power</li>
</ul>
This document describes the REST API for the Power Service.  It assumes basic familiarity with 
<a href="http://www.w3.org/Protocols/">HTTP</a>, 
<a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">REST</a>, and the GLMM.  
For additional background on GLMM power calculations when controlling for a baseline covariate, please see 
<a href="http://www.ncbi.nlm.nih.gov/pubmed/12898543">Glueck &amp; Muller 2003</a>

<h3>Table of Contents</h3>
<div class="toc">
<div class="toc1"><a href="#powersvc">1. The Power Service</a></div>
<div class="toc1"><a href="#params">2. Parameters for the General Linear Multivariate Model</a></div>
<div class="toc2"><a href="#paramsMatrixInputs">2.1 Matrix Inputs</a></div>
<div class="toc3"><a href="#basicMatrix">2.1.1 Basic Matrices</a></div>
<div class="toc3"><a href="#fixedRandomMatrix">2.1.2 Fixed / Random Matrices</a></div>
<div class="toc3"><a href="#essenceMatrix">2.1.3 Essence Matrix</a></div>
<div class="toc3"><a href="#paramsRequiredMatrices">2.1.4 Required Matrices</a></div>
<div class="toc3"><a href="#conformance">2.1.5 Matrix Conformance</a></div>
<div class="toc2"><a href="#paramsLists">2.2 List Inputs</a></div>
<div class="toc1"><a href="#power">3. Calculating Power</a></div>
<div class="toc1"><a href="#samplesize">4. Calculating Sample Size</a></div>
<div class="toc1"><a href="#difference">5. Calculating Detectable Difference</a></div>
<div class="toc1"><a href="#examples">6. Examples</a></div>
<div class="toc2"><a href="#examplesTTest">6.1 One-Sample T-Test</a></div>
<div class="toc2"><a href="#examplesANOVA">6.2 One-Way ANOVA</a></div>
</div>

<h2><a name="powersvc">1. The Power Service</a></h2>
<p>
The Power Service component of the Glimmpse system is a RESTful web service 
which processes requests for power and sample size for the GLMM.  The system
supports GLMM study designs with either all fixed predictors or fixed predictors
with a single baseline covariate (assumed to be normally distributed).  The REST API
allows users to specify the matrices required for GLMM power calculations, and request
power, sample size, or minimum detectable difference.  Users may request a list of power results
which can then be displayed in tables or as power curves.
</p>
<p>
The system is implemented using the <a href="http://www.restlet.org/">Restlet Framework</a>.
Requests to the power service are received via an AJAX call from the Glimmpse user interface,
and data is encoded as XML.  For version 1.0.0, power/sample size results are not persistent, 
so the service deviates slightly from the standard definition of create/update/delete in the 
REST philosophy.
</p>
<p>
The Power Service was developed and tested for use within the <a href="http://tomcat.apache.org/">Apache Tomcat Server (v 6.0)</a>.
</p>

<h2><a name="params">2. Parameters for the General Linear Multivariate Model</a></h2>

Power calculations for the GLMM are based on several matrices which describe 
the study design, estimated regression coefficients, estimated variability, and 
study hypotheses.  Users may request multiple power values in a single request to the
power service, including variations such as different statistical tests, 
type I error values, sample sizes, desired power values, and scale factors for 
regression coefficients and variability.  For designs including a baseline 
covariate, multiple power methods and quantiles may be specified.
<p>
All requests to the power service must specify GLMM power parameters with the general form 
(attributes within [] characters are optional)
</p>

<pre>
&lt;glmmPowerParameters&gt;
  &lt;testList&gt;&lt;v&gt;<i>(hlt|wl|pbt|unirep|unirepBox|unirepGG|unirepHF)</i>&lt;/v&gt;...
    &lt;v&gt;<i>(hlt|wl|pbt|unirep|unirepBox|unirepGG|unirepHF)</i>&lt;/v&gt;&lt;/testList&gt;
  &lt;alphaList&gt;&lt;v&gt;<i>alpha</i>&lt;/v&gt;...&lt;v&gt;<i>alpha</i>&lt;/v&gt;&lt;/alphaList&gt;
  &lt;sigmaScaleList&gt;&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;...&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;&lt;/sigmaScaleList&gt;
  [&lt;powerList&gt;&lt;v&gt;<i>power</i>&lt;/v&gt;...&lt;v&gt;<i>power</i>&lt;/v&gt;&lt;/powerList&gt;]
  [&lt;sampleSizeList&gt;&lt;v&gt;<i>sampleSize</i>&lt;/v&gt;...&lt;v&gt;<i>sampleSize</i>&lt;/v&gt;&lt;/sampleSizeList&gt;]
  [&lt;betaScaleList&gt;&lt;v&gt;<i>betaScale</i>&lt;/v&gt;...&lt;v&gt;<i>betaScale</i>&lt;/v&gt;&lt;/betaScaleList&gt;]
  [&lt;powerMethodList&gt;&lt;v&gt;<i>(conditional|quantile|unconditional)</i>&lt;/v&gt;...
    &lt;v&gt;<i>(conditional|quantile|unconditional)</i>&lt;/v&gt;&lt;/powerMethodList&gt;]
  [&lt;quantileList&gt;&lt;v&gt;<i>quantile</i>&lt;/v&gt;...&lt;v&gt;<i>quantile</i>&lt;/v&gt;&lt;/quantileList&gt;]
  &lt;essenceMatrix&gt;
    &lt;rowMetaData&gt;&lt;r ratio='<i>relativeSize</i>' /&gt;...&lt;r ratio='<i>relativeSize</i>' /&gt;&lt;/rowMetaData&gt;
    &lt;matrix name='<i>fixed</i>' rows='<i>n</i>' columns='<i>q</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,q</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>n,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>n,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>n,q</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
    &lt;randomColumnMetaData&gt;&lt;c mean='<i>mean</i>' variance='<i>variance</i>' /&gt;&lt;/randomColumnMetaData&gt;
    &lt;matrix name='<i>random</i>' rows='<i>n</i>' columns='<i>1</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>n,1</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/essenceMatrix&gt;
  &lt;fixedRandomMatrix name='betweenSubjectContrast' combineHorizontal='true' &gt;
    &lt;matrix name='<i>fixed</i>' rows='<i>a</i>' columns='<i>q</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,q</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>a,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>a,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>a,q</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;    
    &lt;matrix name='<i>random</i>' rows='<i>a</i>' columns='<i>1</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>a,1</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/fixedRandomMatrix&gt;
  &lt;matrix name='<i>withinSubjectContrast</i>' rows='<i>p</i>' columns='<i>b</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,b</sub></i>&lt;/c&gt;&lt;/r&gt;
    ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>p,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>p,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>p,b</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;matrix name='<i>theta</i>' rows='<i>a</i>' columns='<i>b</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,b</sub></i>&lt;/c&gt;&lt;/r&gt;
    ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>a,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>a,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>a,b</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;fixedRandomMatrix name='beta' combineHorizontal='true' &gt;
    &lt;matrix name='<i>fixed</i>' rows='<i>q</i>' columns='<i>p</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,p</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>q,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>q,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>q,p</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;    
    &lt;matrix name='<i>random</i>' rows='<i>1</i>' columns='<i>p</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,p</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/fixedRandomMatrix&gt;
  &lt;!-- Specify sigmaError if all fixed predictors --&gt;
  &lt;matrix name='<i>sigmaError</i>' rows='<i>p</i>' columns='<i>p</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,p</sub></i>&lt;/c&gt;&lt;/r&gt;
    ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>p,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>n,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>p,p</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;!-- Specify the following three sigma matrices if controlling for a baseline covariate --&gt;
  &lt;matrix name='<i>sigmaGaussianRandom</i>' rows='<i>1</i>' columns='<i>1</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;matrix name='<i>sigmaOutcome</i>' rows='<i>p</i>' columns='<i>p</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,p</sub></i>&lt;/c&gt;&lt;/r&gt;
    ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>p,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>n,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>p,p</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;matrix name='<i>sigmaOutcomeGaussianRandom</i>' rows='<i>p</i>' columns='<i>1</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;/r&gt;
     ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>p,1</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
&lt;/glmmPowerParameters&gt;
</pre>

The glmmPowerParameters tag takes no attributes.  The matrix and list input parameters are described in sections <a href="#paramsMatrixInputs">2.1</a> and 
<a href="#paramsLists">2.2</a>

<h3><a name="paramsMatrixInputs">2.1 Matrix Inputs</a></h3>

The power service supports three types of matrix inputs:
<ul>
<li>Basic Matrix - a simple <I>n x m</I> matrix</li>
<li>Fixed / Random Matrix - a matrix which has both a fixed submatrix and a random submatrix</li>
<li>Essence Matrix - the study design matrix, including both fixed and random submatrices, and
meta data describing relative group sizes, and the distribution of the baseline covariate.</li> 
</ul>
<p/>
<h3><a name="basicMatrix">2.1.1 Basic Matrices</a></h3>

A basic matrix is a 2-dimensional array of real numbers with <i>n</i> rows and <i>m</i> columns.  
The XML format for specifying a basic matrix for the Power Service is:
<pre>
&lt;matrix name='<i>name</i>' rows='<i>n</i>' columns='<i>m</i>'&gt;
&lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,m</sub></i>&lt;/c&gt&lt;/r&gt;
...
&lt;r&gt;&lt;c&gt;<i>d<sub>n,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>n,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>n,m</sub></i>&lt;/c&gt&lt;/r&gt;
&lt;/matrix&gt;
</pre>
<table >
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>name</td><td>String</td>
<td>The name of the matrix. 
</td></tr>
<tr><td>rows</td><td>Integer</td><td>Number of rows in the matrix</td></tr>
<tr><td>columns</td><td>Integer</td><td>Number of columns in the matrix</td></tr>
<tr><td>d<sub>i,j</sub></td><td>Real</td><td>Value of cell i,j in the matrix</td></tr>
</table>

<h3><a name="fixedRandomMatrix">2.1.2 Fixed / Random Matrices</a></h3>

A fixed random matrix is a 2-dimensional array of real numbers, which is separated into both a fixed
submatrix and a random submatrix.  Both the regession coefficient matrix (&beta;) and the between 
subject contrast matrix (C) are represented as fixed/random matrices, since they will have fixed and 
random components for study designs with a baseline covariate.  The XML format for a fixed/random matrix is:
<pre>
  &lt;fixedRandomMatrix name='<i>name</i>' combineHorizontal='[true|false]' &gt;
    &lt;matrix name='<i>fixed</i>' rows='<i>n</i>' columns='<i>m</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,m</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>n,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>n,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>n,m</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;    
    &lt;matrix name='<i>random</i>' rows='<i>q</i>' columns='<i>p</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,p</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>q,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>q,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>q,p</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/fixedRandomMatrix&gt;
</pre>
The fixedRandomMatrix tag has two attributes:
<p></p>
<table >
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>name</td><td>String</td><td>the name of the matrix</td></tr>
<tr><td>combineHorizontal</td><td>Boolean</td><td>Indicates if the complete matrix should be created by 
combining the fixed and random submatrices vertically or horizontally</td></tr>
</table>
<p/>
In addition, the fixedRandomMatrix tag encloses two <a href="#basicMatrix">basic matrices</a>, named "fixed" and "random", 
which specify the data in the fixed and random submatrices.

<h3>2.1.3 <a name="essenceMatrix">Essence Matrix</a></h3>

The essence matrix specifies the study design.  Any linear model encoding can be used
for this matrix (cell means, reference cell, etc.).  Since this matrix is used for power analysis, 
it should only include a single row for each unique row in the full design matrix.  Thus,
it is referred to as a design "essence" matrix.  The XML format for the essence matrix is:
<pre>
  &lt;essenceMatrix&gt;
    &lt;rowMetaData&gt;&lt;r ratio='<i>relativeSize</i>' /&gt;...&lt;r ratio='<i>relativeSize</i>' /&gt;&lt;/rowMetaData&gt;
    &lt;matrix name='<i>fixed</i>' rows='<i>n</i>' columns='<i>q</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,q</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>n,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>n,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>n,q</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
    &lt;randomColumnMetaData&gt;&lt;c mean='<i>mean</i>' variance='<i>variance</i>' /&gt;&lt;/randomColumnMetaData&gt;
    &lt;matrix name='<i>random</i>' rows='<i>n</i>' columns='<i>1</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>n,1</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/essenceMatrix&gt;
</pre>

The essenceMatrix tag itself does not have any attributes.  The essenceMatrix tag encloses the following child tags:

<h4>Fixed and Random Basic Matrices</h4>

The essence matrix contains two basic matrices containing the actual data in the design.  Similar to the fixed/random matrix, 
the data is separated into fixed and random components.  The fixed matrix represents the study design coding
for categorical or fixed predictors.  The random matrix represents the random covariate.  The values in this column will
be replaced by random values from a normal distribution with mean and variance specified in the randomColumnMetaData
tag described below.
<p></p>
For version 1.0.0, only a single baseline covariate is allowed.  Therefore, for a fixed submatrix with dimensions <i>n x q</i>,
the random submatrix should have dimensions <i>n x 1</i>.

<h4>Row Meta Data</h4>

Depending on the coding scheme used, each row in the design matrix may represent a unique subgroup of subjects 
in the study.  Since the number of subjects in each group may not be equal, the rowMetaData tag allows users to 
specify the relative size of each subgroup. The rowMetaData tag contains a list of relative sizes for each row in the 
design matrix.  The number of entries enclosed by the rowMetaData tag should match the number of rows in 
both the fixed and random submatrices in the study design.
<pre>
    &lt;rowMetaData&gt;&lt;r ratio='<i>relativeSize</i>' /&gt;...&lt;r ratio='<i>relativeSize</i>' /&gt;&lt;/rowMetaData&gt;
</pre>
The relative sizes are specified with an "r" tag with a single attribute:
<p></p>
<table >
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>ratio</td><td>Positive Integer</td><td>The relative number of subjects in the group represented by the
current row in the design matrix.</td></tr>
</table>
<p></p>
For example, suppose a study is performing a t-test to compare drug A against drug B.  
There are twice as many subjects taking drug A vs. drug B.  In this case, the essence matrix and row meta data 
would be specified as:

<pre>
  &lt;essenceMatrix&gt;
    &lt;rowMetaData&gt;&lt;r ratio='2' /&gt;...&lt;r ratio='1' /&gt;&lt;/rowMetaData&gt;
    &lt;matrix name='<i>fixed</i>' rows='2' columns='2'&gt;
      &lt;r&gt;&lt;c&gt;<i>1</i>&lt;/c&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;
      &lt;r&gt;&lt;c&gt;<i>0</i>&lt;/c&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/essenceMatrix&gt;
</pre>
where the first row in the design matrix corresponds to the drug A group, and the second row corresponds to the drug B group.

<h4>Random Column Meta Data</h4>

The random column meta data is a list of distribution information for each random predictor column in the design matrix.
The number of entries in this list should match the number of columns in the random submatrix in the study design 
(for a single baseline covariate, this list will have one entry).  The first entry in the list corresponds to the first column
 in the random submatrix of the study design, the second with the second column in the random submatrix, and so on.
<p></p>
<pre>
    &lt;randomColumnMetaData&gt;&lt;c mean='<i>mean</i>' variance='<i>variance</i>' /&gt;&lt;/randomColumnMetaData&gt;
</pre>
<p></p>
The randomColumnMetaData tag has no attributes.  It encloses a list of "c" tags with the following attributes.
<p></p>
<table >
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>mean</td><td>Number</td><td>The mean of the normal distribution for the random covariate represented
by the current column in the random submatrix of the study design</td></tr>
<tr><td>variance</td><td>Number</td><td>The variance of the normal distribution for the random covariate represented
by the current column in the random submatrix of the study design</td></tr>
</table>

<h3><a name="paramsRequiredMatrices">2.1.4 Required Matrices</a></h3>

<h4>The Design Essence Matrix</h4>

A single <a href="#essenceMatrix">'X' design essence matrix</a> should be specified to describe the study design.
There are no restrictions on the coding scheme, although the design matrix should be full rank.
The fixed portion of the design represents the study design coding for categorical or fixed predictors.  
The random portion of the design is optional, and should be specified as a column vector when controlling
for a baseline covariate.  

<h4>The Between Subject Contrast Matrix</h4>

A single between subject contrast matrix must be specified.
 The between subject contrast matrix ("C" matrix) defines the between subject hypotheses that the user
wishes to test.  When controlling for a baseline covariate, this matrix includes a random column vector
with the same number of rows as the contrast matrix.  It is most common to have 0's in this column - since the 
value of the baseline covariate is expected to differ across subjects, between subject hypotheses 
do not typically involve the baseline covariate.  

<pre>
  &lt;fixedRandomMatrix name='betweenSubjectContrast' combineHorizontal='true' &gt;
    &lt;matrix name='<i>fixed</i>' rows='<i>a</i>' columns='<i>q</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,q</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>a,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>a,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>a,q</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;    
    &lt;matrix name='<i>random</i>' rows='<i>a</i>' columns='<i>1</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>a,1</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/fixedRandomMatrix&gt;
</pre>

<h4>The Within Subject Contrast Matrix</h4>

The within subject contrast ("U" matrix) defines hypotheses on responses within the
same subject (or other sampling unit).  This matrix is required for multivariate linear models, but
may be omitted for univariate models.
<pre>
  &lt;matrix name='<i>withinSubjectContrast</i>' rows='<i>p</i>' columns='<i>b</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,b</sub></i>&lt;/c&gt;&lt;/r&gt;
    ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>p,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>p,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>p,b</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
</pre>
  
<h4>The Theta Null Matrix</h4>

A single theta null matrix must be specified.  The theta null matrix represents the null hypotheses for
the contrasts defined in the C and U matrices.  It is most common to have 0's in all cells of this matrix,
although this depends on the specific hypotheses being tested.
<pre>
  &lt;matrix name='<i>theta</i>' rows='<i>a</i>' columns='<i>b</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,b</sub></i>&lt;/c&gt;&lt;/r&gt;
    ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>a,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>a,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>a,b</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
</pre>
  
<h4>The Beta Matrix</h4>

A single beta matrix must be specified.  This represents the estimated regression coefficients for the
model (the interpretation depends on the design matrix coding scheme used).  If the study design
includes a baseline covariate, this matrix will include an additional "random" row to represent the estimated
coefficients for the baseline covariate.  The values in this row will be automatically generated based 
on the covariance matrices described below, and should simply be filled with 1's.
<pre>
  &lt;fixedRandomMatrix name='beta' combineHorizontal='true' &gt;
    &lt;matrix name='<i>fixed</i>' rows='<i>q</i>' columns='<i>p</i>'&gt;
      &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,p</sub></i>&lt;/c&gt;&lt;/r&gt;
      ...
      &lt;r&gt;&lt;c&gt;<i>d<sub>q,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>q,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>q,p</sub></i>&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;    
    &lt;matrix name='<i>random</i>' rows='<i>1</i>' columns='<i>p</i>'&gt;
      &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;c&gt;1&lt;/c&gt;...&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/fixedRandomMatrix&gt;
</pre>

<h4>The Covariance (&Sigma;) Matrices</h4>

The sigma matrices represent the estimated covariance for the model.  Different matrices are specified
for fixed designs as opposed to those with a basline covariate.  In general, all sigma matrices should be 
symmetric and positive definite.  All cell values along the diagonal must be positive real numbers.
Off diagonal values should be real numbers.
<p>
<b>Covariance in Fixed Designs</b>
</p>
<p>
When the study design contains only fixed predictors, a single "sigmaError" matrix is specified.  This matrix
represents the estimated residual (or "error") covariance.  For univariate study designs, this will be a 1x1 scalar value.
</p>
<pre>
  &lt;matrix name='<i>sigmaError</i>' rows='<i>p</i>' columns='<i>p</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,p</sub></i>&lt;/c&gt;&lt;/r&gt;
    ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>p,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>n,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>p,p</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
</pre>

<b>Covariance in Designs with a Baseline Covariate</b>
<p>
For study designs including a baseline covariate, three matrices must be specified to fully describe the
variability.
</p>
<b>Covariance of Baseline Covariate (&Sigma;<sub>G</sub>)</b> - since only a single baseline covariate
is allowed, this matrix is 1x1 and represents the estimated variance of the baseline covariate.
<p>
<u>Known issue:</u> the variance of the baseline covariate is also specified in the essence matrix.  The
value specified in the random column meta data should match the value in &Sigma;<sub>G</sub> to
ensure valid power results.
</p>
<pre>
  &lt;matrix name='<i>sigmaGaussianRandom</i>' rows='<i>1</i>' columns='<i>1</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
</pre>
<b>Covariance of Responses (&Sigma;<sub>Y</sub>)</b> - covariance between responses on the same
subject (or sampling unit).  For univariate designs, this is a 1x1 matrix.
<pre>
  &lt;matrix name='<i>sigmaOutcome</i>' rows='<i>p</i>' columns='<i>p</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>1,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>1,p</sub></i>&lt;/c&gt;&lt;/r&gt;
    ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>p,1</sub></i>&lt;/c&gt;&lt;c&gt;<i>d<sub>n,2</sub></i>&lt;/c&gt;...&lt;c&gt;<i>d<sub>p,p</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
</pre>
<b>Covariance of Outcomes with Baseline Covariate (&Sigma;<sub>YG</sub>)</b> - column vector indicating the covariance
between each outcome and the baseline covariate.
<pre>  
  &lt;matrix name='<i>sigmaOutcomeGaussianRandom</i>' rows='<i>p</i>' columns='<i>1</i>'&gt;
    &lt;r&gt;&lt;c&gt;<i>d<sub>1,1</sub></i>&lt;/c&gt;&lt;/r&gt;
     ...
    &lt;r&gt;&lt;c&gt;<i>d<sub>p,1</sub></i>&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
</pre>

<h3><a name="conformance">2.1.5 Matrix Conformance</a></h3>

For successful computation of power for the GLMM, the required matrices must conform appropriately to 
one another.  The following table lists the dimensions required for each of the matrices:
<p></p>
<table>
<tr><th>Matrix</th><th>Rows</th><th>Columns</th><th>Conformance Details</th></tr>
<tr><td>X: Design essence matrix</td><td>N</td><td>Q</td><td>Columns equal number of rows in &beta;</td></tr>
<tr><td>C: Between subject contrast</td><td>A</td><td>Q</td><td>Columns equal number of rows in &beta;
<br>Rows must be one less than number of rows in X</br></td></tr>
<tr><td>U: Within subject contrast</td><td>P</td><td>B</td><td>Rows equals the number of columns in &beta;</td></tr>
<tr><td>&Theta;: Null hypothesis values</td><td>A</td><td>B</td><td>Rows equals the number of rows in C<br>
Columns equals the number of columns in U</br></td></tr>
<tr><td>&beta;: Regression coefficient estimates</td><td>Q</td><td>P</td><td>Rows equals the number of columns
in X (number of predictors)<br>Columns equals the number of columns in U (number of outcomes)</br></td></tr>
<tr class='bgGray'><td colspan='4' >Design with fixed predictors only</td></tr>
<tr><td>&Sigma;: covariance matrix of residuals<sub>error</sub></td><td>P</td><td>P</td>
<td>Matrix is square and symmetric.<br>Rows/columns equal the number of columns in &beta;</br></td></tr>
<tr class='bgGray'><td colspan='4' background='#ddd'>Design which controls for a baseline covariate</td></tr>
<tr><td>&Sigma;<sub>G</sub>: Covariance of Gaussian predictor</td><td>1</td><td>1</td>
<td>Since only a single baseline covariate is allowed, this matrix is 1x1.</td></tr>
<tr><td>&Sigma;<sub>YG</sub>: Covariance of Gaussian predictor with outcomes</td><td>P</td><td>1</td>
<td>Rows equals the number of columns in &beta;</td></tr>
<tr><td>&Sigma;<sub>Y</sub>: Covariance of outcomes</td><td>P</td><td>P</td>
<td>Rows/columns equal the number of columns in &beta; (i.e. number of outcomes)</td></tr>
</table>

<h3><a name="paramsLists">2.2 List Inputs</a></h3>

Once the required matrices are specified, users may request a list of powers by varying 
the basic study design. Users can scale the regression coefficients in the beta matrix and 
the variability specified in the sigma matrix. Users may also specify several statistical tests, 
power methods (for designs with a baseline covariate), power values, alpha levels, and
per group sample size values.
<p></p>
Note that each combination of values specified in these lists will produce a single power calculation.  
Therefore, list sizes should be minimized to avoid long processing times.

<h4>Test List</h4>

The test list includes all statistical tests to be run.  It is required for all requests.  The test list is specified as:
<pre>
&lt;testList&gt;&lt;v&gt;<i>testList</i>&lt;/v&gt;...&lt;v&gt;<i>testList</i>&lt;/v&gt;&lt;/testList&gt;
</pre>

Power values should be equivalent for univariate designs regardless of the test selected.
However, no uniformly most powerful test exists for the multivariate linear model.  The following
tests are supported:
<ul>
<li>unirep - Univariate approach to repeated measures (uncorrected)</li>
<li>unirepBox - Univariate approach to repeated measures with Box correction</li>
<li>unirepGG - Univariate approach to repeated measures with Geisser-Greenhouse correction</li>
<li>unirepHF - Univariate approach to repeated measures with Huynh-Feldt correction</li>
<li>wl - Wilks' Lambda</li>
<li>hlt - Hotelling-Lawley trace</li>
<li>pbt - Pillai-Bartlett trace</li>
</ul>

<h4>Power List</h4>
The power list includes all desired power values.  It is valid for sample size or detectable
difference requests (it is ignored for power requests).  A power list is specified as follows:
<pre>
&lt;powerList&gt;&lt;v&gt;<i>power</i>&lt;/v&gt;...&lt;v&gt;<i>power</i>&lt;/v&gt;&lt;/powerList&gt;
</pre>
where each listed <i>power</i> is a decimal between 0 and 1.  Researchers typically
require a minimum of 80&#37; power (0.80), so values between 0.80 and 1 are most common.

<h4>Alpha List</h4>

The alpha list specifies various type I error rates.  It is required for all requests.
<pre>
&lt;alphaList&gt;&lt;v&gt;<i>alpha</i>&lt;/v&gt;...&lt;v&gt;<i>alpha</i>&lt;/v&gt;&lt;/alphaList&gt;
</pre>
where each listed <i>alpha</i> is a decimal between 0 and 1. The most commonly used 
values are 0.01, 0.05, and 0.10, which correspond to confidence levels of 99&#37;, 95&#37;, 
and 90&#37; respectively.

<h4>Per Group Sample Size List</h4>

The per group sample size list includes all desired group sample sizes.  It is valid for power or 
detectable difference requests (it is ignored for sample size requests).   The design essence matrix 
will include the relative group sizes for each row in the design matrix.  The per group sample size will
be multiplied by the relative group size to determine the number of subjects in that group.
<p></p>
For example, suppose a study has three treatment groups A,B, and C.  There are twice as many subjects 
receiving treatment A than group B or group C.  The cell means coded design matrix would have the 
following structure:
<table cellspacing='0' cellpadding='5'>
<tr><th>Relative Size</th><th>A</th><th>B</th><th>C</th></tr>
<tr><td class='borderRight'>1</td><td>1</td><td>0</td><td>0</td></tr>
<tr><td class='borderRight'>2</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td class='borderRight'>1</td><td>0</td><td>0</td><td>1</td></tr>
</table>
For a per group sample size of 5, the study design would include 5 subjects in group A, 10 subjects
in group B, and 5 subjects in group C (total sample size = 20).  Similarly, a per group sample size of 10 would yield
10, 20, and 10 subjects (total sample size = 40) in groups A,B,and C respectively.
<p></p>
A sample size list is specified as follows:
<pre>
&lt;sampleSizeList&gt;&lt;v&gt;<i>sampleSize</i>&lt;/v&gt;...&lt;v&gt;<i>sampleSize</i>&lt;/v&gt;&lt;/sampleSizeList&gt;
</pre>
where each listed <i>sampleSize</i> is a positive integer.  

<h4>Beta Scale List</h4>

The beta scale list includes all scale factors for the regression coefficient, or beta, matrix.  The beta scale
list is valid for power and sample size requests (it is ignored for detectable difference requests).

A beta scale list is specified as follows:
<pre>
&lt;betaScaleList&gt;&lt;v&gt;<i>betaScale</i>&lt;/v&gt;...&lt;v&gt;<i>betaScale</i>&lt;/v&gt;&lt;/betaScaleList&gt;
</pre>
where each listed <i>betaScale</i> is a real number.  

<h4>Sigma Scale List</h4>

The sigma scale list includes all scale factors for the error covariance matrix.  The sigma scale
list is required for all requests.

A sigma scale list is specified as follows:
<pre>
&lt;sigmaScaleList&gt;&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;...&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;&lt;/sigmaScaleList&gt;
</pre>
where each listed <i>sigmaScale</i> is a real number.  

<h4>Power Method List</h4>

The power method lists includes any combination of the conditional, unconditional, or quantile power methods.
It is valid only for study designs involving a baseline covariate (ignored otherwise).  Note that only the 
Hotelling-Lawley and univariate approach to repeated measures are supported for designs with a 
baseline covariate.
<p></p>
A power method list is specified as follows:
<pre>
&lt;powerMethodList&gt;&lt;v&gt;<i>powerMethod</i>&lt;/v&gt;...&lt;v&gt;<i>powerMethod</i>&lt;/v&gt;&lt;/powerMethodList&gt;
</pre>
The following power methods are supported:
<ul>
<li>conditional - Power values conditional on the specific realization of the baseline covariate values</li>
<li>unconditional - Power based on numerical integration over possible values of the non-centrality parameter</li>
<li>quantile - Power based on specific quantiles of the non-centrality parameter's distribution</li>
</ul>
<h4>Quantile List</h4>

The quantile list specifies all quantiles for use with the "quantile" power method.  This list is
valid only for study designs with a baseline covariate, which specify quantile power in
the power method list.
A quantile list is specified as follows:
<pre>
&lt;quantileList&gt;&lt;v&gt;<i>quantile</i>&lt;/v&gt;...&lt;v&gt;<i>quantile</i>&lt;/v&gt;&lt;/quantileList&gt;
</pre>
where each quantile is a real number between 0 and 1.

<h2><a name="power">3. Calculating Power</a></h2>

New power calculations are "created" with the following URI:
<pre>
POST /power/power/
</pre>
Parameters are specified in the entity body as:
<pre>
&lt;glmmPowerParameters&gt;
  &lt;testList&gt;&lt;v&gt;<i>(hlt|wl|pbt|unirep|unirepBox|unirepGG|unirepHF)</i>&lt;/v&gt;...
    &lt;v&gt;<i>(hlt|wl|pbt|unirep|unirepBox|unirepGG|unirepHF)</i>&lt;/v&gt;&lt;/testList&gt;
  &lt;alphaList&gt;&lt;v&gt;<i>alpha</i>&lt;/v&gt;...&lt;v&gt;<i>alpha</i>&lt;/v&gt;&lt;/alphaList&gt;
  &lt;sigmaScaleList&gt;&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;...&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;&lt;/sigmaScaleList&gt;
  &lt;sampleSizeList&gt;&lt;v&gt;<i>sampleSize</i>&lt;/v&gt;...&lt;v&gt;<i>sampleSize</i>&lt;/v&gt;&lt;/sampleSizeList&gt;
  &lt;betaScaleList&gt;&lt;v&gt;<i>betaScale</i>&lt;/v&gt;...&lt;v&gt;<i>betaScale</i>&lt;/v&gt;&lt;/betaScaleList&gt;
  [&lt;powerMethodList&gt;&lt;v&gt;<i>(conditional|quantile|unconditional)</i>&lt;/v&gt;...
    &lt;v&gt;<i>(conditional|quantile|unconditional)</i>&lt;/v&gt;&lt;/powerMethodList&gt;]
  [&lt;quantileList&gt;&lt;v&gt;<i>quantile</i>&lt;/v&gt;...&lt;v&gt;<i>quantile</i>&lt;/v&gt;&lt;/quantileList&gt;]
  
...<i>required matrices</i>...

&lt;/glmmPowerParameters&gt;
</pre>

Power requests must contain all <a href="#paramsRequiredMatrices:">required matrices</a>,
a testList, an alphaList, a betaScaleList, a sigmaScaleList, and a sampleSizeList.
<p></p>
<a name="powerResults">Power results are returned as:</a>
<pre>
&lt;?xml version='1.0' encoding='UTF-8' standalone='no'?&gt;
&lt;powerList count='<i>numberOfResults</i>'&gt;
&lt;glmmPower alpha='<i>alpha</i>' nominalPower='<i>nominalPower</i>' 
actualPower='<i>actualPower</i>' sampleSize='<i>totalSampleSize</i>' 
betaScale='<i>betaScale</i>' sigmaScale='<i>sigmaScale</i>' /&gt;
...
&lt;/powerList&gt;
</pre>
The powerList tag encloses the list of power results and has a single attribute "count"
which specifies the number of results in the list.
<p></p>
The glmmPower tag describes a specific power result and has the following attributes: 
<table >
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>alpha</td><td>Real</td><td>Type I error rate associated with this power result.  
The value ranges from 0 to 1, although 0.01, 0.05, and 0.10 are typical.</td></tr>
<tr><td>nominalPower</td><td>Real</td>
<td>The desired power for this calculation (specified with sample size or detectable difference requests).
For power requests, this value will be equal to the actualPower attribute.</td></tr>
<tr><td>actualPower</td><td>Real</td>
<td>The actual power associated with this power result.  
For sample size and detectable difference requests, it may not be possible to perfectly match the
desired power for certain study designs.  This value will be set to the calculated power associated 
with the sample size or detectable difference which most closely matches the desired power.</td></tr>
<tr><td>sampleSize</td><td>Real</td><td>The total sample size for this power result</td></tr>
<tr><td>betaScale</td><td>Real</td><td>The scale factor applied to the beta matrix for this power result.
This value can be used to generate the beta matrix representing the detectable difference.</td></tr>
<tr><td>sigmaScale</td><td>Real</td><td>The scale factor applied to the error matrix for this power result</td></tr>
</table>

<h2><a name="samplesize">4. Calculating Sample Size</a></h2>

New sample size calculations are "created" with the following URI:
<pre>
POST /power/samplesize/
</pre>
Parameters are specified in the entity body as:
<pre>
&lt;glmmPowerParameters&gt;
  &lt;testList&gt;&lt;v&gt;<i>(hlt|wl|pbt|unirep|unirepBox|unirepGG|unirepHF)</i>&lt;/v&gt;...
    &lt;v&gt;<i>(hlt|wl|pbt|unirep|unirepBox|unirepGG|unirepHF)</i>&lt;/v&gt;&lt;/testList&gt;
  &lt;alphaList&gt;&lt;v&gt;<i>alpha</i>&lt;/v&gt;...&lt;v&gt;<i>alpha</i>&lt;/v&gt;&lt;/alphaList&gt;
  &lt;sigmaScaleList&gt;&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;...&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;&lt;/sigmaScaleList&gt;
  &lt;powerList&gt;&lt;v&gt;<i>power</i>&lt;/v&gt;...&lt;v&gt;<i>power</i>&lt;/v&gt;&lt;/powerList&gt;
  &lt;betaScaleList&gt;&lt;v&gt;<i>betaScale</i>&lt;/v&gt;...&lt;v&gt;<i>betaScale</i>&lt;/v&gt;&lt;/betaScaleList&gt;
  [&lt;powerMethodList&gt;&lt;v&gt;<i>(conditional|quantile|unconditional)</i>&lt;/v&gt;...
    &lt;v&gt;<i>(conditional|quantile|unconditional)</i>&lt;/v&gt;&lt;/powerMethodList&gt;]
  [&lt;quantileList&gt;&lt;v&gt;<i>quantile</i>&lt;/v&gt;...&lt;v&gt;<i>quantile</i>&lt;/v&gt;&lt;/quantileList&gt;]
  
...<i>required matrices</i>...

&lt;/glmmPowerParameters&gt;
</pre>

Sample size requests must include all <a href="#paramsRequiredMatrices">required matrices</a>,
a testList, an alphaList, a betaScaleList, a sigmaScaleList, and a powerList.
<p></p>
Results are returned as described in the <a href="#powerResults">power results section</a>.
The sample size results should be extracted from the sampleSize attribute in each glmmPower object.

<h2><a name="difference">5. Calculating Detectable Difference</a></h2>

New detectable difference calculations are "created" with the following URI:
<pre>
POST /power/difference/
</pre>
Parameters are specified in the entity body as:
<pre>
&lt;glmmPowerParameters&gt;
  &lt;testList&gt;&lt;v&gt;<i>(hlt|wl|pbt|unirep|unirepBox|unirepGG|unirepHF)</i>&lt;/v&gt;...
    &lt;v&gt;<i>(hlt|wl|pbt|unirep|unirepBox|unirepGG|unirepHF)</i>&lt;/v&gt;&lt;/testList&gt;
  &lt;alphaList&gt;&lt;v&gt;<i>alpha</i>&lt;/v&gt;...&lt;v&gt;<i>alpha</i>&lt;/v&gt;&lt;/alphaList&gt;
  &lt;sigmaScaleList&gt;&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;...&lt;v&gt;<i>sigmaScale</i>&lt;/v&gt;&lt;/sigmaScaleList&gt;
  [&lt;powerList&gt;&lt;v&gt;<i>power</i>&lt;/v&gt;...&lt;v&gt;<i>power</i>&lt;/v&gt;&lt;/powerList&gt;]
  [&lt;sampleSizeList&gt;&lt;v&gt;<i>sampleSize</i>&lt;/v&gt;...&lt;v&gt;<i>sampleSize</i>&lt;/v&gt;&lt;/sampleSizeList&gt;]
  [&lt;betaScaleList&gt;&lt;v&gt;<i>betaScale</i>&lt;/v&gt;...&lt;v&gt;<i>betaScale</i>&lt;/v&gt;&lt;/betaScaleList&gt;]
  [&lt;powerMethodList&gt;&lt;v&gt;<i>(conditional|quantile|unconditional)</i>&lt;/v&gt;...
    &lt;v&gt;<i>(conditional|quantile|unconditional)</i>&lt;/v&gt;&lt;/powerMethodList&gt;]
  [&lt;quantileList&gt;&lt;v&gt;<i>quantile</i>&lt;/v&gt;...&lt;v&gt;<i>quantile</i>&lt;/v&gt;&lt;/quantileList&gt;]
  
...<i>required matrices</i>...

&lt;/glmmPowerParameters&gt;
</pre>

Detectable difference requests must include all <a href="#paramsRequiredMatrices">required matrices</a>,
a testList, an alphaList, a sigmaScaleList, a sampleSizeList, and a powerList.
<p></p>
Results are returned as described in the <a href="#powerResults">power results section</a>.  
Since regression coefficients are specified as a beta matrix, the "detectable difference" is
found in the betaScale attribute of the glmmPower result.  For easier interpretation of this value,
the beta matrix should have a 1 in cells for groups expected to differ, and a 0 otherwise.
<p>
Example beta matrix for 2 outcomes, 3 treatment groups.  Treatment effect expected in group 1 on outcome 1.
<table  cellpadding='5' cellspacing='0'>
<tr><td>1</td><td>0</td></tr>
<tr><td>0</td><td>0</td></tr>
<tr><td>0</td><td>0</td></tr>
</table>
</p>

<h2><a name="examples">6. Examples</a></h2>

<h3><a name="examplesTTest">6.1 One-Sample T-Test</a></h3>

Suppose we are comparing mean height in sample of 200 adult males against a known height for US males.
We will assume a standard deviation of 8 inches (i.e. variance = 64).  We would like to determine the power for
detecting a difference of 2 inches.  We will use the univariate approach to repeated measures as our statistical test, 
and a type I error rate of 0.05.
<p></p>
To calculate power, we would send the following HTTP request to the Power Service:
<pre>
POST /power/power
</pre>
with the entity body (whitespace included for legibility, actual entity bodies for power service 
should have extraneous whitespace removed):
<pre>
&lt;glmmPowerParameters&gt;
  &lt;testList&gt;&lt;v&gt;unirep&lt;/v&gt;&lt;/testList&gt;
  &lt;alphaList&gt;&lt;v&gt;0.05&lt;/v&gt;&lt;/alphaList&gt;
  &lt;sigmaScaleList&gt;&lt;v&gt;64&lt;/v&gt;&lt;/sigmaScaleList&gt;
  &lt;sampleSizeList&gt;&lt;v&gt;200&lt;/v&gt;&lt;/sampleSizeList&gt;
  &lt;betaScaleList&gt;&lt;v&gt;2&lt;/v&gt;&lt;/betaScaleList&gt;
  &lt;essenceMatrix&gt;
    &lt;rowMetaData&gt;&lt;r ratio='1' /&gt;&lt;/rowMetaData&gt;
    &lt;columnMetaData&gt;&lt;c type='fixed' /&gt;&lt;/columnMetaData&gt;
    &lt;matrix name='design' rows='1' columns='1'&gt;&lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;&lt;/matrix&gt;
  &lt;/essenceMatrix&gt;
  &lt;matrix name='betweenSubjectContrast' rows='1' columns='1'&gt;
    &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;matrix name='withinSubjectContrast' rows='2' columns='2'&gt;
    &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
    &lt;r&gt;&lt;c&gt;-1&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;matrix name='theta' rows='1' columns='1'&gt;&lt;r&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;&lt;/matrix&gt;
  &lt;matrix name='beta' rows='1' columns='2'&gt;&lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;&lt;/matrix&gt;
  &lt;matrix name='sigmaError' rows='2' columns='2'&gt;
    &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;c&gt;0.5&lt;/c&gt;&lt;/r&gt;
    &lt;r&gt;&lt;c&gt;0.5&lt;/c&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
&lt;/glmmPowerParameters&gt;
</pre>

This yields the results:
<pre>
&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;powerList count="3"&gt;
&lt;glmmPower actualPower="0.9404375882587327" alpha="0.05" betaScale="2.0"  nominalPower="0.9404375882587327" 
    powerMethod="conditional" sampleSize="200" sigmaScale="64.0" test="unirepBox"/&gt;
&lt;/powerList&gt;
</pre>
Indicating that power = 0.94 to detect a difference of 2 inches.

<h3><a name="examplesANOVA">6.2 One-Way ANOVA</a></h3>

Suppose we are comparing resting heart rate in individuals taking three drugs A, B, and C.
There are equal numbers of subjects taking each drug.
We wish to determine the power for detecting a difference of 5 beats/min between the groups,
when there are 10, 15, or 20 subjects in each group.
We will use a cell means coding (3x3 identity matrix) for our study design.
<p></p>
To calculate power, we would send the following HTTP request to the Power Service:
<pre>
POST /power/power
</pre>
with the entity body (whitespace included for legibility, actual entity bodies for power service 
should have extraneous whitespace removed):
<pre>
&lt;glmmPowerParameters&gt;
  &lt;alphaList&gt;&lt;v&gt;0.05&lt;/v&gt;&lt;/alphaList&gt;
  &lt;sampleSizeList&gt;&lt;v&gt;10&lt;/v&gt;&lt;v&gt;15&lt;/v&gt;&lt;v&gt;20&lt;/v&gt;&lt;/sampleSizeList&gt;
  &lt;essenceMatrix&gt;
    &lt;rowMetaData&gt;&lt;r ratio='1' /&gt;&lt;r ratio='1' /&gt;&lt;r ratio='1' /&gt;&lt;/rowMetaData&gt;
    &lt;matrix name='fixed' rows='3' columns='3'&gt;
      &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;c&gt;0&lt;/c&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;
      &lt;r&gt;&lt;c&gt;0&lt;/c&gt;&lt;c&gt;1&lt;/c&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;
      &lt;r&gt;&lt;c&gt;0&lt;/c&gt;&lt;c&gt;0&lt;/c&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/essenceMatrix&gt;
  &lt;betaScaleList&gt;&lt;v&gt;5&lt;/v&gt;&lt;/betaScaleList&gt;
  &lt;fixedRandomMatrix name='beta' combineHorizontal='false' &gt;
    &lt;matrix name='fixed' rows='3' columns='1'&gt;
      &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
      &lt;r&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;
      &lt;r&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/fixedRandomMatrix&gt;
  &lt;fixedRandomMatrix name='betweenSubjectContrast' combineHorizontal='true' &gt;
    &lt;matrix name='fixed' rows='2' columns='3'&gt;
      &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;c&gt;-1&lt;/c&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;
      &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;c&gt;0&lt;/c&gt;&lt;c&gt;-1&lt;/c&gt;&lt;/r&gt;
    &lt;/matrix&gt;
  &lt;/fixedRandomMatrix&gt;
  &lt;matrix name='withinSubjectContrast' rows='1' columns='1'&gt;
    &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;matrix name='theta' rows='2' columns='1'&gt;
    &lt;r&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;
    &lt;r&gt;&lt;c&gt;0&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;matrix name='sigmaError' rows='1' columns='1'&gt;
    &lt;r&gt;&lt;c&gt;1&lt;/c&gt;&lt;/r&gt;
  &lt;/matrix&gt;
  &lt;sigmaScaleList&gt;&lt;v&gt;20&lt;/v&gt;&lt;/sigmaScaleList&gt;
  &lt;testList&gt;&lt;v&gt;unirep&lt;/v&gt;&lt;/testList&gt;
  &lt;powerMethodList&gt;&lt;v&gt;conditional&lt;/v&gt;&lt;/powerMethodList&gt;
&lt;/glmmPowerParameters&gt;
</pre>
This yields the results:
<pre>
&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;powerList count="3"&gt;
&lt;glmmPower actualPower="0.6843301311850237" alpha="0.05" betaScale="5.0" nominalPower="0.6843301311850237"
   powerMethod="conditional" sampleSize="30" sigmaScale="20.0" test="unirep"/&gt;
 &lt;glmmPower actualPower="0.8724721326515791" alpha="0.05" betaScale="5.0" nominalPower="0.8724721326515791" 
   powerMethod="conditional" sampleSize="45" sigmaScale="20.0" test="unirep"/&gt;
 &lt;glmmPower actualPower="0.9543921012167697" alpha="0.05" betaScale="5.0" nominalPower="0.9543921012167697" 
   powerMethod="conditional" sampleSize="60" sigmaScale="20.0" test="unirep"/&gt;
&lt;/powerList&gt;
</pre>
This indicates that power = 0.68 for 10 subjects per group, 0.87 with 15 subjects per group, and 0.95 with 20 subjects per group.

</body>
</html>
